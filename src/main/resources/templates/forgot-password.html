<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Forgot Password</title>
</head>
<body>
<div class="card shadow mx-auto" style="width: 400px; margin-top: 50px;">
    <div class="card-body p-4">
        <h3 class="text-center mb-4">Account Recovery</h3>

        <div id="step1">
            <input type="text" id="user" class="form-control mb-3" placeholder="Enter Username">
            <button onclick="sendOtp()" class="btn btn-primary w-100">Send OTP</button>
        </div>

        <div id="step2" style="display:none;">
            <p class="text-muted small">Enter the 6-digit code sent to your console.</p>
            <input type="text" id="otpCode" class="form-control mb-3" placeholder="6-Digit OTP">
            <input type="password" id="newPass" class="form-control mb-3" placeholder="New Password">
            <button onclick="resetPass()" class="btn btn-success w-100">Reset Password</button>
        </div>

        <div id="msg" class="mt-3 text-center small"></div>
    </div>
</div>

<script>
    async function sendOtp() {
        const username = document.getElementById('user').value;
        const response = await fetch('/api/auth/forgot-password/send-otp', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({ username })
        });
        const text = await response.text();
        if(response.ok) {
            document.getElementById('step1').style.display = 'none';
            document.getElementById('step2').style.display = 'block';
            document.getElementById('msg').className = "text-success mt-2";
        }
        document.getElementById('msg').innerText = text;
    }

    async function resetPass() {
        const response = await fetch('/api/auth/forgot-password/verify', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({
                username: document.getElementById('user').value,
                otp: document.getElementById('otpCode').value,
                newPassword: document.getElementById('newPass').value
            })
        });
        const text = await response.text();
        if(response.ok) {
            document.getElementById('msg').className = "text-success mt-2";
            setTimeout(() => window.location.href = '/login', 2000);
        } else {
            document.getElementById('msg').className = "text-danger mt-2";
        }
        document.getElementById('msg').innerText = text;
    }
</script>
</body>
</html>