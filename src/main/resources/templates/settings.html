    <!DOCTYPE html>
    <html lang="en" xmlns:th="http://www.thymeleaf.org">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Settings | CBD Teams</title>
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Bitcount+Single:wght@100..900&family=Outfit:wght@100..900&display=swap" rel="stylesheet">

        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
        <link th:href="@{/css/style.css}" rel="stylesheet">
    </head>
    <body>

    <div class="container-fluid">
        <div class="row">
            <nav class="col-md-3 col-lg-2 d-md-block sidebar collapse shadow-sm">
                <div class="position-sticky pt-3">
                    <div class="px-3 mb-4">
                        <h1 class="fw-bold head logo" style="color: #cea530;">CBD</h1>
                    </div>
                    <ul class="nav flex-column">
                        <li class="nav-item">
                            <a class="nav-link" href="/index"><i class="bi bi-house-door me-2"></i> My Activities</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#"><i class="bi bi-briefcase-fill me-2"></i> My Actions</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#"><i class="bi bi-kanban me-2"></i> Projects</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#"><i class="bi bi-bookmarks-fill me-2"></i> Reports</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="/team"><i class="bi bi-people me-2"></i> Team</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link active" href="/settings"><i class="bi bi-gear me-2"></i> Settings</a>
                        </li>
                    </ul>
                    <div class="mt-5 px-3">
                        <a href="/logout" class="btn btn-outline-danger btn-sm w-100">Logout</a>
                    </div>
                </div>
            </nav>

            <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
                <div class="pt-4 pb-2 mb-4 border-bottom">
                    <h1 class="h4 fw-bold">Account Settings</h1>
                </div>

                <div class="row justify-content-start">
                    <div class="col-lg-8">
                        <div class="card shadow-sm mb-5">
                            <div class="settings-header-gradient text-center">
                                <div class="position-relative d-inline-block">
                                    <img th:src="${session.profilePic}" id="previewImg" class="rounded-circle border border-4 border-white shadow" width="150" height="150" style="background: white; object-fit: cover;">
                                    <label for="newImg" class="btn btn-sm btn-light position-absolute bottom-0 end-0 rounded-circle shadow-sm">
                                        <i class="bi bi-camera-fill"></i>
                                    </label>
                                    <input type="file" id="newImg" hidden accept="image/*">
                                </div>
                            </div>

                            <div class="card-body p-4">
                                <form id="settingsForm">
                                    <div class="row g-4">
                                        <div class="col-md-6">
                                            <label class="form-label small fw-bold text-muted text-uppercase">Staff ID</label>
                                            <input type="text" class="form-control bg-light" th:value="${session.loggedStaff}" readonly>
                                        </div>
                                        <div class="col-md-6">
                                            <label class="form-label small fw-bold text-muted text-uppercase">Full Name</label>
                                            <input type="text" id="newName" class="form-control" th:value="${session.staffName}" required>
                                        </div>

                                        <div class="col-12 mt-4">
                                            <div class="d-flex justify-content-between align-items-center p-3 bg-light rounded-3 border">
                                                <div>
                                                    <h6 class="fw-bold mb-1">Security Credentials</h6>
                                                    <p class="text-muted small mb-0" id="passStatusText">Update your password to stay secure.</p>
                                                </div>
                                                <button type="button" class="btn btn-sm btn-outline-primary fw-bold" data-bs-toggle="modal" data-bs-target="#resetPasswordModal">
                                                    Change Password
                                                </button>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="mt-5 border-top pt-4 text-end">
                                        <span id="statusMsg" class="me-3 small fw-bold"></span>
                                        <button type="submit" class="btn btn-primary px-5 shadow-sm">Save All Changes</button>
                                    </div>

                                    <div class="modal fade" id="resetPasswordModal" tabindex="-1" aria-hidden="true">
                                        <div class="modal-dialog modal-dialog-centered">
                                            <div class="modal-content border-0 shadow-lg">
                                                <div class="modal-header border-0 bg-light p-4">
                                                    <h5 class="modal-title fw-bold">Reset Password</h5>
                                                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                                                </div>
                                                <div class="modal-body p-4">
                                                    <div class="mb-4">
                                                        <label class="form-label small fw-bold text-danger">CURRENT PASSWORD</label>
                                                        <input type="password" id="oldPassword" class="form-control" placeholder="Verify identity">
                                                    </div>
                                                    <hr>
                                                    <div class="mb-3">
                                                        <label class="form-label small fw-bold text-muted">NEW PASSWORD</label>
                                                        <input type="password" id="newPassword" class="form-control"
                                                               placeholder="Minimum 8 characters" minlength="8">
                                                        <div class="form-text small">Password must be at least 8 characters long.</div>
                                                    </div>
                                                    <div class="mb-3">
                                                        <label class="form-label small fw-bold text-muted">CONFIRM NEW PASSWORD</label>
                                                        <input type="password" id="confirmNewPassword" class="form-control" placeholder="Repeat new password">
                                                    </div>
                                                </div>
                                                <div class="modal-footer border-0 p-4 pt-0">
                                                    <button type="button" class="btn btn-light" data-bs-dismiss="modal">Cancel</button>
                                                    <button type="button" class="btn btn-primary px-4" onclick="applyPassword()">Confirm Reset</button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Preview image
        document.getElementById('newImg').onchange = function(evt) {
            const [file] = this.files;
            if (file) document.getElementById('previewImg').src = URL.createObjectURL(file);
        }

        // Modal Apply logic
        function applyPassword() {
        const n = document.getElementById('newPassword').value;
        const c = document.getElementById('confirmNewPassword').value;
        const o = document.getElementById('oldPassword').value;

        if (o === "") return alert("Please enter your current password.");

        // NEW: Length Validation
        if (n.length > 0 && n.length < 8) {
            alert("New password is too short! It must be at least 8 characters.");
            return;
        }

        if (n !== c) return alert("New passwords don't match!");

        document.getElementById('passStatusText').innerText = "Password reset ready (Click Save All to finalize)";
        document.getElementById('passStatusText').className = "text-success small fw-bold";

        bootstrap.Modal.getInstance(document.getElementById('resetPasswordModal')).hide();
    }

        // Submit Logic
        document.getElementById('settingsForm').onsubmit = async (e) => {
            e.preventDefault();
            const msg = document.getElementById('statusMsg');
            msg.innerText = "Syncing with server...";

            const formData = new FormData();
            formData.append('name', document.getElementById('newName').value);
            formData.append('oldPassword', document.getElementById('oldPassword').value);
            formData.append('newPassword', document.getElementById('newPassword').value);

            const file = document.getElementById('newImg').files[0];
            if(file) formData.append('image', file);

            try {
                const res = await fetch('/api/staff/update-profile', { method: 'POST', body: formData });
                const text = await res.text();

                if(res.ok) {
                    msg.className = "me-3 text-success";
                    msg.innerText = "✓ Updated successfully!";
                    setTimeout(() => location.reload(), 1200);
                } else {
                    msg.className = "me-3 text-danger";
                    msg.innerText = "✗ " + text;
                }
            } catch (err) {
                msg.innerText = "Connection error.";
            }
        };
    </script>
    </body>
    </html>