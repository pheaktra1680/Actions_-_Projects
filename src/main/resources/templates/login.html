<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Auth | Welcome</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link th:href="@{/css/style.css}" rel="stylesheet">
</head>
<body>

<div class="main-container" id="main">

    <div class="form-container sign-up-container">
        <form id="regForm" class="form-wrapper">
            <h2 class="fw-bold">Create Account</h2>
            <input type="text" id="regUser" class="form-control" placeholder="Username" required />
            <input type="password" id="regPass" class="form-control" placeholder="Password" required />
            <input type="password" id="confirmPass" class="form-control" placeholder="Confirm Password" required />
            <div id="passError" class="text-danger small" style="display:none;">Passwords do not match!</div>
            <button type="submit" class="btn_login">Register</button>
            <div id="regMsg" class="mt-3 small"></div>
        </form>
    </div>

    <div class="form-container sign-in-container">
        <form id="loginForm" class="form-wrapper">
            <h2 class="fw-bold">Sign In</h2>
            <input type="text" id="loginUser" class="form-control" placeholder="Username" required />
            <input type="password" id="loginPass" class="form-control" placeholder="Password" required />
            <a href="/forgot-password" class="forgot-link text-sm">Forgot your password?</a>
            <button type="submit" class="btn_login">Login</button>
            <div id="loginMsg" class="mt-3 small"></div>
        </form>
    </div>

    <div class="overlay-container">
        <div class="overlay">
            <div class="overlay-panel overlay-left">
                <h1 class="fw-bold">Welcome Back!</h1>
                <p>To keep connected with us please login with your personal info</p>
                <button class="btn_login ghost" id="signIn">Sign In</button>
            </div>
            <div class="overlay-panel overlay-right">
                <h1 class="fw-bold">Hello, CBD Teams!</h1>
                <p>Enter your personal details</p>
                <button class="btn_login ghost" id="signUp">Register Now</button>
            </div>
        </div>
    </div>
</div>



<script>
    const signUpButton = document.getElementById('signUp');
    const signInButton = document.getElementById('signIn');
    const main = document.getElementById('main');

    // Toggle Animation
    signUpButton.addEventListener('click', () => main.classList.add("active"));
    signInButton.addEventListener('click', () => main.classList.remove("active"));

    // --- YOUR EXISTING LOGIN FETCH ---
    document.getElementById('loginForm').onsubmit = async (e) => {
        e.preventDefault();
        const msg = document.getElementById('loginMsg');
        msg.innerText = "Authenticating...";

        const response = await fetch('/api/auth/login', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({
                username: document.getElementById('loginUser').value,
                password: document.getElementById('loginPass').value
            })
        });

        if(response.ok) {
            const data = await response.json();
            window.location.href = data.url;
        } else {
            msg.className = "text-danger small mt-2";
            msg.innerText = "Invalid credentials";
        }
    };

    // --- YOUR EXISTING REGISTER FETCH ---
    document.getElementById('regForm').onsubmit = async (e) => {
        e.preventDefault();
        const pass = document.getElementById('regPass').value;
        const confirm = document.getElementById('confirmPass').value;
        if (pass !== confirm) {
            document.getElementById('passError').style.display = 'block';
            return;
        }

        const response = await fetch('/api/auth/register', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({
                username: document.getElementById('regUser').value,
                password: pass
            })
        });

        if(response.ok) {
            alert("Registration successful! Now login.");
            main.classList.remove("active");
        }
    };
</script>
</body>
</html>